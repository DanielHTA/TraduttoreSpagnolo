<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LingoTutor G3 - EdiciÃ³n MÃ©xico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;600;900&display=swap');
        
        body { 
            font-family: 'Outfit', sans-serif; 
            background-color: #fdf6f0;
            background-image: url("https://www.transparenttextures.com/patterns/cubes.png"); /* PatrÃ³n sutil */
        }

        .rosa-mexicano { color: #E4007C; }
        .bg-rosa-mexicano { background-color: #E4007C; }
        .border-talavera { border-image: linear-gradient(to right, #005596, #00a1df) 1; }
        
        .mexican-card {
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 8px solid #E4007C;
            border-radius: 24px;
        }

        .btn-gradient {
            background: linear-gradient(135deg, #E4007C 0%, #FF5A5F 100%);
            transition: all 0.3s ease;
        }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(228, 0, 124, 0.3);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <div id="loginOverlay" class="fixed inset-0 bg-stone-900/80 backdrop-blur-md z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] p-8 w-full max-w-md shadow-2xl border-t-8 border-rosa-mexicano">
            <div class="text-center mb-6">
                <span class="text-5xl">ğŸŒµ</span>
                <h2 class="text-3xl font-black mt-4">Â¡Bienvenidos!</h2>
                <p class="text-gray-500">Configura tu API Key para despertar al tutor.</p>
            </div>
            <input type="password" id="apiKeyInput" placeholder="Google API Key" 
                   class="w-full p-4 bg-gray-100 border-none rounded-2xl mb-4 outline-none focus:ring-4 focus:ring-pink-200 transition-all text-center">
            <button onclick="unlock()" class="w-full btn-gradient text-white font-black py-4 rounded-2xl tracking-widest uppercase">
                Entrar al Taller
            </button>
        </div>
    </div>

    <div class="max-w-5xl mx-auto opacity-0 transition-opacity duration-700" id="mainApp">
        
        <header class="flex flex-col md:flex-row justify-between items-end mb-12 gap-6">
            <div class="border-l-8 border-rosa-mexicano pl-6">
                <h1 class="text-5xl font-black tracking-tighter text-stone-800">LINGO<span class="rosa-mexicano">TUTOR</span></h1>
                <p class="text-stone-500 font-bold uppercase tracking-widest text-sm">Inteligencia Artificial â€¢ Gemini 3 Flash</p>
            </div>

            <div class="flex flex-wrap gap-3 items-center bg-white p-3 rounded-3xl shadow-sm border border-stone-200">
                <span class="text-xs font-black text-stone-400 px-2">IDIOMA DE ESTUDIO:</span>
                <select id="langSelect" class="bg-stone-100 border-none rounded-xl px-4 py-2 font-bold text-stone-700 outline-none focus:ring-2 focus:ring-pink-500 cursor-pointer">
                    <option value="EspaÃ±ol (MÃ©xico)">EspaÃ±ol ğŸ‡²ğŸ‡½</option>
                    <option value="English (US)">English ğŸ‡ºğŸ‡¸</option>
                    <option value="English (UK)">English ğŸ‡¬ğŸ‡§</option>
                    <option value="FranÃ§ais">FranÃ§ais ğŸ‡«ğŸ‡·</option>
                    <option value="Deutsch">Deutsch ğŸ‡©ğŸ‡ª</option>
                    <option value="Italiano">Italiano ğŸ‡®ğŸ‡¹</option>
                    <option value="PortuguÃªs">PortuguÃªs ğŸ‡§ğŸ‡·</option>
                    <option value="æ—¥æœ¬èª">æ—¥æœ¬èª ğŸ‡¯ğŸ‡µ</option>
                    <option value="í•œêµ­ì–´">í•œêµ­ì–´ ğŸ‡°ğŸ‡·</option>
                    <option value="ä¸­æ–‡ (Mandarin)">ä¸­æ–‡ ğŸ‡¨ğŸ‡³</option>
                    <option value="Ğ ÑƒÑÑĞºĞ¸Ğ¹">Ğ ÑƒÑÑĞºĞ¸Ğ¹ ğŸ‡·ğŸ‡º</option>
                    <option value="Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ğŸ‡¸ğŸ‡¦</option>
                    <option value="à¤¹à¤¿à¤¨à¥à¤¦à¥€">à¤¹à¤¿à¤¨à¥à¤¦à¥€ ğŸ‡®ğŸ‡³</option>
                    <option value="NÃ¡huatl">NÃ¡huatl ğŸ‡²ğŸ‡½ (Bonus)</option>
                    <option value="Maya">Maya ğŸ‡²ğŸ‡½ (Bonus)</option>
                </select>
            </div>
        </header>

        <main class="grid gap-8">
            <div class="mexican-card p-4 shadow-xl">
                <div class="flex flex-col md:flex-row gap-3">
                    <input type="text" id="userInput" placeholder="Escribe una palabra o frase..." 
                           class="flex-1 p-6 text-xl font-medium bg-transparent outline-none placeholder:text-stone-300">
                    <button onclick="ask()" class="btn-gradient text-white px-12 py-5 rounded-2xl font-black text-lg shadow-lg">
                        CONSULTAR
                    </button>
                </div>
            </div>

            <div id="loading" class="hidden text-center py-20">
                <div class="inline-block animate-spin text-5xl mb-4">âš™ï¸</div>
                <p class="rosa-mexicano font-black tracking-widest animate-pulse">EL TUTOR ESTÃ PREPARANDO LA LECCIÃ“N...</p>
            </div>

            <div id="result" class="hidden animate-in fade-in zoom-in duration-500">
                <div class="mexican-card p-8 md:p-12 shadow-2xl relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-24 h-24 bg-indigo-600 opacity-10 rounded-bl-full"></div>
                    
                    <div id="content" class="text-stone-700 prose prose-stone max-w-none leading-relaxed text-lg">
                        </div>

                    <div class="mt-12 pt-8 border-t border-stone-100 flex flex-wrap gap-4 justify-between items-center">
                        <div class="flex gap-4">
                            <button onclick="copyResult()" class="text-sm font-black rosa-mexicano hover:opacity-70 uppercase">Copiar LecciÃ³n</button>
                            <button onclick="window.print()" class="text-sm font-black text-stone-400 hover:text-stone-800 uppercase">Imprimir PDF</button>
                        </div>
                        <button onclick="lock()" class="text-xs font-bold text-stone-300 hover:text-red-500 transition-colors">CERRAR SESIÃ“N</button>
                    </div>
                </div>
            </div>
        </main>

        <footer class="mt-20 text-center pb-12">
        </footer>
    </div>

    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        window.unlock = () => {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (key.length < 10) return alert("Por favor, ingresa una Key vÃ¡lida.");
            sessionStorage.setItem('MEX_G3_KEY', key);
            checkAuth();
        };

        window.lock = () => {
            sessionStorage.removeItem('MEX_G3_KEY');
            location.reload();
        };

        function checkAuth() {
            if (sessionStorage.getItem('MEX_G3_KEY')) {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('mainApp').classList.replace('opacity-0', 'opacity-100');
            }
        }
        checkAuth();

        window.ask = async () => {
            const key = sessionStorage.getItem('MEX_G3_KEY');
            const input = document.getElementById('userInput').value;
            const targetLang = document.getElementById('langSelect').value;
            const content = document.getElementById('content');
            const resultDiv = document.getElementById('result');
            const loading = document.getElementById('loading');

            if (!input) return;

            loading.classList.remove('hidden');
            resultDiv.classList.add('hidden');

            try {
                const genAI = new GoogleGenerativeAI(key);
                const model = genAI.getGenerativeModel({ model: "gemini-2.5-flash" });

                const prompt = `ActÃºa como un tutor lingÃ¼Ã­stico experto con una personalidad cÃ¡lida y pedagÃ³gica.
                Analiza la expresiÃ³n: "${input}". 
                Explica todo detalladamente en el idioma: ${targetLang}.
                
                La respuesta debe seguir este orden:
                1. ğŸ‡²ğŸ‡½ 'La Idea Principal': TraducciÃ³n y significado conceptual.
                2. ğŸ§ 'Bajo la lupa': AnÃ¡lisis gramatical detallado.
                3. ğŸ­ 'Â¿CÃ³mo suena?': Explica el registro (formal, informal, coloquial).
                4. ğŸŒ® 'Dato Curioso/Cultural': Una nota sobre el origen o uso cultural.
                5. ğŸ“ 'Ponlo en prÃ¡ctica': 3 frases de ejemplo con sus traducciones.
                
                Formatea la respuesta usando HTML (<b>, <i>, <p>). Usa un estilo limpio.`;

                const result = await model.generateContent(prompt);
                const response = await result.response;
                
                content.innerHTML = response.text()
                    .replace(/\n/g, '<br>')
                    .replace(/\*\*(.*?)\*\*/g, '<b class="text-indigo-900">$1</b>')
                    .replace(/### (.*?)/g, '<h3 class="text-2xl font-black mt-6 mb-3 rosa-mexicano tracking-tight">$1</h3>');

                resultDiv.classList.remove('hidden');
            } catch (e) {
                alert("Hubo un problema con la API. Verifica tu conexiÃ³n y tu Key.");
            } finally {
                loading.classList.add('hidden');
            }
        };

        window.copyResult = () => {
            const text = document.getElementById('content').innerText;
            navigator.clipboard.writeText(text);
            alert("Â¡LecciÃ³n copiada!");
        };
    </script>
</body>
</html>
