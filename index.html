<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LingoTutor G3 </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;600;900&display=swap');
        body { 
            font-family: 'Outfit', sans-serif; 
            background-color: #fdf6f0;
            background-image: url("https://www.transparenttextures.com/patterns/cubes.png");
        }
        .rosa-mexicano { color: #E4007C; }
        .mexican-card {
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 8px solid #E4007C;
            border-radius: 24px;
        }
        .btn-gradient {
            background: linear-gradient(135deg, #E4007C 0%, #FF5A5F 100%);
            transition: all 0.3s ease;
        }
        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(228, 0, 124, 0.3);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <div id="loginOverlay" class="fixed inset-0 bg-stone-900/80 backdrop-blur-md z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] p-8 w-full max-w-md shadow-2xl border-t-8 border-[#E4007C]">
            <div class="text-center mb-6">
                <span class="text-5xl">ğŸŒµ</span>
                <h2 class="text-3xl font-black mt-4 text-stone-800">Â¡Bienvenidos!</h2>
                <p class="text-gray-500">Configura tu API Key de Gemini para comenzar.</p>
            </div>
            <input type="password" id="apiKeyInput" placeholder="Google API Key" 
                   class="w-full p-4 bg-gray-100 border-none rounded-2xl mb-4 outline-none focus:ring-4 focus:ring-pink-200 text-center">
            <button onclick="unlock()" class="w-full btn-gradient text-white font-black py-4 rounded-2xl tracking-widest uppercase">
                Entrar al Taller
            </button>
        </div>
    </div>

    <div class="max-w-5xl mx-auto opacity-0 transition-opacity duration-700" id="mainApp">
        
        <header class="flex flex-col md:flex-row justify-between items-end mb-12 gap-6">
            <div class="border-l-8 border-[#E4007C] pl-6">
                <h1 class="text-5xl font-black tracking-tighter text-stone-800 uppercase">Lingo<span class="rosa-mexicano">Tutor</span></h1>
                <p class="text-stone-500 font-bold uppercase tracking-widest text-sm">IA Nativa </p>
            </div>

            <div class="flex flex-wrap gap-3 items-center">
                <button onclick="lock()" class="bg-white p-3 rounded-2xl shadow-sm border border-stone-200 hover:bg-red-50 transition-colors group">
                    <span class="text-xs font-black text-stone-400 group-hover:text-red-500 uppercase tracking-tighter">ğŸ”‘ Cambiar Key</span>
                </button>

                <div class="flex items-center bg-white p-3 rounded-2xl shadow-sm border border-stone-200">
                    <span class="text-xs font-black text-stone-400 px-2">APRENDER EN:</span>
                    <select id="langSelect" class="bg-stone-100 border-none rounded-xl px-4 py-1 font-bold text-stone-700 outline-none focus:ring-2 focus:ring-pink-500 cursor-pointer">
                        <option value="EspaÃ±ol (MÃ©xico)">EspaÃ±ol ğŸ‡²ğŸ‡½</option>
                        <option value="English (US)">English ğŸ‡ºğŸ‡¸</option>
                        <option value="FranÃ§ais">FranÃ§ais ğŸ‡«ğŸ‡·</option>
                        <option value="Deutsch">Deutsch ğŸ‡©ğŸ‡ª</option>
                        <option value="Italiano">Italiano ğŸ‡®ğŸ‡¹</option>
                        <option value="PortuguÃªs">PortuguÃªs ğŸ‡§ğŸ‡·</option>
                        <option value="æ—¥æœ¬èª">æ—¥æœ¬èª ğŸ‡¯ğŸ‡µ</option>
                    </select>
                </div>
            </div>
        </header>

        <main class="grid gap-8">
            <div class="mexican-card p-4 shadow-xl">
                <div class="flex flex-col md:flex-row gap-3">
                    <input type="text" id="userInput" placeholder="Escribe una palabra o frase..." 
                           class="flex-1 p-6 text-xl font-medium bg-transparent outline-none">
                    <button onclick="ask()" class="btn-gradient text-white px-12 py-5 rounded-2xl font-black text-lg shadow-lg uppercase">
                        Consultar
                    </button>
                </div>
            </div>

            <div id="loading" class="hidden text-center py-20">
                <div class="inline-block animate-spin text-5xl mb-4">âš™ï¸</div>
                <p class="rosa-mexicano font-black tracking-widest animate-pulse">PREPARANDO LA LECCIÃ“N...</p>
            </div>

            <div id="result" class="hidden animate-in fade-in zoom-in duration-500">
                <div class="mexican-card p-8 md:p-12 shadow-2xl relative overflow-hidden">
                    <div id="content" class="text-stone-700 prose prose-stone max-w-none leading-relaxed text-lg">
                        </div>

                    <div class="mt-12 pt-8 border-t border-stone-100 flex justify-between items-center">
                        <button onclick="copyResult()" class="text-sm font-black rosa-mexicano hover:opacity-70 uppercase">Copiar LecciÃ³n</button>
                        <span class="text-xs font-bold text-stone-300 uppercase italic">LingoTutor v3.0</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        const overlay = document.getElementById('loginOverlay');
        const app = document.getElementById('mainApp');

        window.unlock = () => {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (key.length < 10) return alert("Por favor, ingresa una Key vÃ¡lida.");
            sessionStorage.setItem('MEX_G3_KEY', key);
            checkAuth();
        };

        // FunciÃ³n para "Cerrar sesiÃ³n" y volver al inicio
        window.lock = () => {
            sessionStorage.removeItem('MEX_G3_KEY');
            app.classList.replace('opacity-100', 'opacity-0');
            setTimeout(() => {
                location.reload(); // Recargamos para limpiar todo estado
            }, 300);
        };

        function checkAuth() {
            if (sessionStorage.getItem('MEX_G3_KEY')) {
                overlay.style.display = 'none';
                app.classList.replace('opacity-0', 'opacity-100');
            }
        }
        checkAuth();

        window.ask = async () => {
            const key = sessionStorage.getItem('MEX_G3_KEY');
            const input = document.getElementById('userInput').value;
            const targetLang = document.getElementById('langSelect').value;
            const content = document.getElementById('content');
            const resultDiv = document.getElementById('result');
            const loading = document.getElementById('loading');

            if (!input) return;

            loading.classList.remove('hidden');
            resultDiv.classList.add('hidden');

            try {
                const genAI = new GoogleGenerativeAI(key);
                // Usamos 1.5 Flash que es el estÃ¡ndar actual estable y gratuito
                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

                const prompt = `Eres un tutor lingÃ¼Ã­stico experto mexicano. 
                Analiza la expresiÃ³n: "${input}". Explica todo en el idioma: ${targetLang}.
                
                Usa este formato Markdown:
                # ğŸ‡²ğŸ‡½ La Idea Principal
                (Significado)
                # ğŸ§ Bajo la lupa
                (GramÃ¡tica)
                # ğŸ­ Registro
                (Formal/Informal)
                # ğŸŒ® Dato Curioso
                (Cultura)
                # ğŸ“ PrÃ¡ctica
                (3 ejemplos)`;

                const result = await model.generateContent(prompt);
                const response = await result.response;
                
                // Renderizado profesional de Markdown a HTML
                content.innerHTML = marked.parse(response.text());
                resultDiv.classList.remove('hidden');
            } catch (e) {
                console.error(e);
                alert("Error de API. Verifica tu llave y que tengas conexiÃ³n.");
            } finally {
                loading.classList.add('hidden');
            }
        };

        window.copyResult = () => {
            const text = document.getElementById('content').innerText;
            navigator.clipboard.writeText(text);
            alert("Â¡Copiado!");
        };
    </script>
</body>
</html>
